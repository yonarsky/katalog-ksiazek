const search = document.getElementById('search');
const books = document.getElementById('ksiazki');

const searchBooks = async searchText => {
  const res = await fetch('data.json');
  const books = await res.json();

  let matches = books.filter(book => {
      const regex = new RegExp(`^${searchText}`, 'gi');
      return book.tytul.match(regex) || book.autor.match(regex) || book.wydawnictwo.match(regex) || book.kategoria.match(regex);
  });
    if (searchText.length === 0) {
        books.innerHTML += '<div class="col-md-6" id="ekspozycja">            <div class="card mb-3" style="max-width: 540px;">          <div class="row no-gutters">            <div class="col-md-4">              <img src="img/ekspozycja.jpg" class="card-img" alt="...">            </div>            <div class="col-md-8">              <div class="card-body">                <h5 class="card-title" id="tytul">Ekspozycja</h5>                <p class="card-text" id="autor">Mróz Remigiusz</p>                <p class="card-text" id="wydawnictwo"><small class="text-muted">Wydawnictwo Filia</small></p>                <p class="card-text" id="kategoria"><small class="text-muted">kryminał</small></p>              </div>            </div>          </div>        </div>        </div>        <div class="col-md-6" id="wiekszosc-bezwzgledna">            <div class="card mb-3" style="max-width: 540px;">          <div class="row no-gutters">            <div class="col-md-4">              <img src="img/wiekszosc-bezwzgledna.jpg" class="card-img" alt="...">            </div>            <div class="col-md-8">              <div class="card-body">                <h5 class="card-title" id="tytul">Większość bezwzględna</h5>                <p class="card-text" id="autor">Mróz Remigiusz</p>                <p class="card-text" id="wydawnictwo"><small class="text-muted">Wydawnictwo Filia</small></p>                <p class="card-text" id="kategoria"><small class="text-muted">political fiction</small></p>              </div>            </div>          </div>        </div>        </div>        <div class="col-md-6" id="czysty-kod">            <div class="card mb-3" style="max-width: 540px;">          <div class="row no-gutters">            <div class="col-md-4">              <img src="img/czysty-kod.jpg" class="card-img" alt="...">            </div>            <div class="col-md-8">              <div class="card-body">                <h5 class="card-title" id="tytul">Czysty kod</h5>                <p class="card-text" id="autor">Martin Robert C.</p>                <p class="card-text" id="wydawnictwo"><small class="text-muted">Wydawnictwo Helion</small></p>                <p class="card-text" id="kategoria"><small class="text-muted">informatyka</small></p>              </div>            </div>          </div>        </div>        </div>        <div class="col-md-6" id="bieguni">            <div class="card mb-3" style="max-width: 540px;">          <div class="row no-gutters">            <div class="col-md-4">              <img src="img/bieguni.jpg" class="card-img" alt="...">            </div>            <div class="col-md-8">              <div class="card-body">                <h5 class="card-title" id="tytul">Bieguni</h5>                <p class="card-text" id="autor">Tokarczuk Olga</p>                <p class="card-text" id="wydawnictwo"><small class="text-muted">Wydawnictwo Literackie</small></p>                <p class="card-text" id="kategoria"><small class="text-muted">literatura piękna</small></p>              </div>            </div>          </div>        </div>        </div>        <div class="col-md-6" id="lalka">            <div class="card mb-3" style="max-width: 540px;">          <div class="row no-gutters">            <div class="col-md-4">              <img src="img/lalka.jpg" class="card-img" alt="...">            </div>            <div class="col-md-8">              <div class="card-body">                <h5 class="card-title" id="tytul">Lalka</h5>                <p class="card-text" id="autor">Prus Bolesław</p>                <p class="card-text" id="wydawnictwo"><small class="text-muted">Wydawnictwo Zakład Narodowy im. Ossolińskich</small></p>                <p class="card-text" id="kategoria"><small class="text-muted">klasyka</small></p>              </div>            </div>          </div>        </div>        </div>        <div class="col-md-6" id="java-podstawy-wydanie-x">            <div class="card mb-3" style="max-width: 540px;">          <div class="row no-gutters">            <div class="col-md-4">              <img src="img/java-x.jpg" class="card-img" alt="...">            </div>            <div class="col-md-8">              <div class="card-body">                <h5 class="card-title" id="tytul">Java. Podstawy. Wydanie X</h5>                <p class="card-text" id="autor">Horstmann Cay S.</p>                <p class="card-text" id="wydawnictwo"><small class="text-muted">Wydawnictwo Helion</small></p>                <p class="card-text" id="kategoria"><small class="text-muted">informatyka</small></p>              </div>            </div>          </div>        </div>        </div>        <div class="col-md-6" id="ostatnie-zyczenie">            <div class="card mb-3" style="max-width: 540px;">          <div class="row no-gutters">            <div class="col-md-4">              <img src="img/ostatnie-zyczenia.jpg" class="card-img" alt="...">            </div>            <div class="col-md-8">              <div class="card-body">                <h5 class="card-title" id="tytul">Ostatnie życzenie</h5>                <p class="card-text" id="autor">Sapkowski Andrzej</p>                <p class="card-text" id="wydawnictwo"><small class="text-muted">Wydawnictwo superNOWA</small></p>                <p class="card-text" id="kategoria"><small class="text-muted">fantasy</small></p>              </div>            </div>          </div>        </div>        </div>        <div class="col-md-6" id="rasputin">            <div class="card mb-3" style="max-width: 540px;">          <div class="row no-gutters">            <div class="col-md-4">              <img src="img/rasputin.jpg" class="card-img" alt="...">            </div>            <div class="col-md-8">              <div class="card-body">                <h5 class="card-title" id="tytul">Rasputin. Wiara, władza i zmierzch dynastii Romanowów</h5>                <p class="card-text" id="autor">Smith Douglas</p>                <p class="card-text" id="wydawnictwo"><small class="text-muted">Wydawnictwo Literackie</small></p>                <p class="card-text" id="kategoria"><small class="text-muted">biografia</small></p>              </div>            </div>          </div>        </div>        </div>        <div class="col-md-6" id="ksiegi-jakubowe">            <div class="card mb-3" style="max-width: 540px;">          <div class="row no-gutters">            <div class="col-md-4">              <img src="img/ksiegi-jakubowe.jpg" class="card-img" alt="...">            </div>            <div class="col-md-8">              <div class="card-body">                <h5 class="card-title" id="tytul">Księgi Jakubowe</h5>                <p class="card-text" id="autor">Tokarczuk Olga</p>                <p class="card-text" id="wydawnictwo"><small class="text-muted">Wydawnictwo Literackie</small></p>                <p class="card-text" id="kategoria"><small class="text-muted">powieść historyczna</small></p>              </div>            </div>          </div>        </div>        </div>        <div class="col-md-6" id="caeremoniale-episcoporum">            <div class="card mb-3" style="max-width: 540px;">          <div class="row no-gutters">            <div class="col-md-4">              <img src="img/caeremoniale-episcoporum.jpg" class="card-img" alt="...">            </div>            <div class="col-md-8">              <div class="card-body">                <h5 class="card-title">Cæremoniale Episcoporum</h5>                <p class="card-text">praca zbiorowa</p>                <p class="card-text"><small class="text-muted">Wydawnictwo Libreria Editrice Vaticana</small></p>                <p class="card-text" id="kategoria"><small class="text-muted">księga liturgiczna</small></p>              </div>            </div>          </div>        </div>        </div>';
    }
    outputHtml(matches);
};

const outputHtml = matches => {
    if (matches.length > 0) {
        books.innerHTML = '';
        const html = matches.map(match => `
        <div class="col-md-6"><div class="card mb-3" style="max-width: 540px;"><div class="row no-gutters"><div class="col-md-4"><img src="img/${match.okladka}" class="card-img"></div><div class="col-md-8"><div class="card-body"><h5 class="card-title" id="tytul">${match.tytul}</h5><p class="card-text" id="autor">${match.autor}</p><p class="card-text" id="wydawnictwo"><small class="text-muted">${match.wydawnictwo}</small></p><p class="card-text" id="kategoria"><small class="text-muted">${match.kategoria}</small></p></div></div></div></div></div>
      `)
        .join('');
        books.innerHTML += html;
    }
};

search.addEventListener('input', () => searchBooks(search.value));
